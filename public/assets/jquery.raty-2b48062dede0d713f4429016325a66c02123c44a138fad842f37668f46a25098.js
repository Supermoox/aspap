!function(t){var e={init:function(o){return this.each(function(){var a=this,n=t(a).empty();a.opt=t.extend(!0,{},t.fn.raty.defaults,o),n.data("settings",a.opt),a.opt.number=e.between(a.opt.number,0,20),"/"!=a.opt.path.substring(a.opt.path.length-1,a.opt.path.length)&&(a.opt.path+="/"),"function"==typeof a.opt.score&&(a.opt.score=a.opt.score.call(a)),a.opt.score&&(a.opt.score=e.between(a.opt.score,0,a.opt.number));for(var r=1;r<=a.opt.number;r++)t("<img />",{src:a.opt.path+(!a.opt.score||a.opt.score<r?a.opt.starOff:a.opt.starOn),alt:r,title:r<=a.opt.hints.length&&null!==a.opt.hints[r-1]?a.opt.hints[r-1]:r}).appendTo(a),a.opt.space&&n.append(r<a.opt.number?"&#160;":"");a.stars=n.children('img:not(".raty-cancel")'),a.score=t("<input />",{type:"hidden",name:a.opt.scoreName}).appendTo(a),a.opt.score&&a.opt.score>0&&(a.score.val(a.opt.score),e.roundStar.call(a,a.opt.score)),a.opt.iconRange&&e.fill.call(a,a.opt.score),e.setTarget.call(a,a.opt.score,a.opt.targetKeep);var i=a.opt.space?4:0,s=a.opt.width||a.opt.number*a.opt.size+a.opt.number*i;a.opt.cancel&&(a.cancel=t("<img />",{src:a.opt.path+a.opt.cancelOff,alt:"x",title:a.opt.cancelHint,"class":"raty-cancel"}),"left"==a.opt.cancelPlace?n.prepend("&#160;").prepend(a.cancel):n.append("&#160;").append(a.cancel),s+=a.opt.size+i),a.opt.readOnly?(e.fixHint.call(a),a.cancel&&a.cancel.hide()):(n.css("cursor","pointer"),e.bindAction.call(a)),n.css("width",s)})},between:function(t,e,o){return Math.min(Math.max(parseFloat(t),e),o)},bindAction:function(){var o=this,a=t(o);a.mouseleave(function(){var t=o.score.val()||undefined;e.initialize.call(o,t),e.setTarget.call(o,t,o.opt.targetKeep),o.opt.mouseover&&o.opt.mouseover.call(o,t)});var n=o.opt.half?"mousemove":"mouseover";o.opt.cancel&&o.cancel.mouseenter(function(){t(this).attr("src",o.opt.path+o.opt.cancelOn),o.stars.attr("src",o.opt.path+o.opt.starOff),e.setTarget.call(o,null,!0),o.opt.mouseover&&o.opt.mouseover.call(o,null)}).mouseleave(function(){t(this).attr("src",o.opt.path+o.opt.cancelOff),o.opt.mouseover&&o.opt.mouseover.call(o,o.score.val()||null)}).click(function(t){o.score.removeAttr("value"),o.opt.click&&o.opt.click.call(o,null,t)}),o.stars.bind(n,function(n){var r=parseInt(this.alt,10);if(o.opt.half){var i=parseFloat((n.pageX-t(this).offset().left)/o.opt.size),s=i>.5?1:.5;r=parseFloat(this.alt)-1+s,e.fill.call(o,r),o.opt.precision&&(r=r-s+i),e.showHalf.call(o,r)}else e.fill.call(o,r);a.data("score",r),e.setTarget.call(o,r,!0),o.opt.mouseover&&o.opt.mouseover.call(o,r,n)}).click(function(t){o.score.val(o.opt.half||o.opt.precision?a.data("score"):this.alt),o.opt.click&&o.opt.click.call(o,o.score.val(),t)})},cancel:function(o){return t(this).each(function(){var a=this;if(!0===t(a).data("readonly"))return this;o?e.click.call(a,null):e.score.call(a,null),a.score.removeAttr("value")})},click:function(o){return t(this).each(function(){if(!0===t(this).data("readonly"))return this;e.initialize.call(this,o),this.opt.click?this.opt.click.call(this,o):e.error.call(this,'you must add the "click: function(score, evt) { }" callback.'),e.setTarget.call(this,o,!0)})},error:function(e){t(this).html(e),t.error(e)},fill:function(t){for(var e,o,a,n=this,r=n.stars.length,i=0,s=1;s<=r;s++)e=n.stars.eq(s-1),n.opt.iconRange&&n.opt.iconRange.length>i?(o=n.opt.iconRange[i],a=n.opt.single?s==t?o.on||n.opt.starOn:o.off||n.opt.starOff:s<=t?o.on||n.opt.starOn:o.off||n.opt.starOff,s<=o.range&&e.attr("src",n.opt.path+a),s==o.range&&i++):(a=n.opt.single?s==t?n.opt.starOn:n.opt.starOff:s<=t?n.opt.starOn:n.opt.starOff,e.attr("src",n.opt.path+a))},fixHint:function(){var e=t(this),o=parseInt(this.score.val(),10),a=this.opt.noRatedMsg;!isNaN(o)&&o>0&&(a=o<=this.opt.hints.length&&null!==this.opt.hints[o-1]?this.opt.hints[o-1]:o),e.data("readonly",!0).css("cursor","default").attr("title",a),this.score.attr("readonly","readonly"),this.stars.attr("title",a)},getScore:function(){var e,o=[];return t(this).each(function(){e=this.score.val(),o.push(e?parseFloat(e):undefined)}),o.length>1?o:o[0]},readOnly:function(o){return this.each(function(){var a=t(this);if(a.data("readonly")===o)return this;this.cancel&&(o?this.cancel.hide():this.cancel.show()),o?(a.unbind(),a.children("img").unbind(),e.fixHint.call(this)):(e.bindAction.call(this),e.unfixHint.call(this)),a.data("readonly",o)})},reload:function(){return e.set.call(this,{})},roundStar:function(t){var e=(t-Math.floor(t)).toFixed(2);if(e>this.opt.round.down){var o=this.opt.starOn;e<this.opt.round.up&&this.opt.halfShow?o=this.opt.starHalf:e<this.opt.round.full&&(o=this.opt.starOff),this.stars.eq(Math.ceil(t)-1).attr("src",this.opt.path+o)}},score:function(){return arguments.length?e.setScore.apply(this,arguments):e.getScore.call(this)},set:function(e){return this.each(function(){var o=t(this),a=o.data("settings"),n=o.clone().removeAttr("style").insertBefore(o);o.remove(),n.raty(t.extend(a,e))}),t(this.selector)},setScore:function(o){return t(this).each(function(){if(!0===t(this).data("readonly"))return this;e.initialize.call(this,o),e.setTarget.call(this,o,!0)})},setTarget:function(o,a){if(this.opt.target){var n=t(this.opt.target);0==n.length&&e.error.call(this,"target selector invalid or missing!");var r=o;r=a&&r!==undefined?"hint"==this.opt.targetType?null===r&&this.opt.cancel?this.opt.cancelHint:this.opt.hints[Math.ceil(r-1)]:this.opt.precision?parseFloat(r).toFixed(1):parseInt(r,10):this.opt.targetText,this.opt.targetFormat.indexOf("{score}")<0&&e.error.call(this,'template "{score}" missing!'),null!==o&&(r=this.opt.targetFormat.toString().replace("{score}",r)),n.is(":input")?n.val(r):n.html(r)}},showHalf:function(t){var e=(t-Math.floor(t)).toFixed(1);e>0&&e<.6&&this.stars.eq(Math.ceil(t)-1).attr("src",this.opt.path+this.opt.starHalf)},initialize:function(t){t=t?e.between(t,0,this.opt.number):0,e.fill.call(this,t),t>0&&(this.opt.halfShow&&e.roundStar.call(this,t),this.score.val(t))},unfixHint:function(){for(var e=0;e<this.opt.number;e++)this.stars.eq(e).attr("title",e<this.opt.hints.length&&null!==this.opt.hints[e]?this.opt.hints[e]:e);t(this).data("readonly",!1).css("cursor","pointer").removeAttr("title"),this.score.attr("readonly","readonly")}};t.fn.raty=function(o){return e[o]?e[o].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof o&&o?void t.error("Method "+o+" does not exist!"):e.init.apply(this,arguments)},t.fn.raty.defaults={cancel:!1,cancelHint:"cancel this rating!",cancelOff:"cancel-off.png",cancelOn:"cancel-on.png",cancelPlace:"left",click:undefined,half:!1,halfShow:!0,hints:["bad","poor","regular","good","gorgeous"],iconRange:undefined,mouseover:undefined,noRatedMsg:"not rated yet",number:5,path:"img/",precision:!1,round:{down:.25,full:.6,up:.76},readOnly:!1,score:undefined,scoreName:"score",single:!1,size:16,space:!0,starHalf:"star-half.png",starOff:"star-off.png",starOn:"star-on.png",target:undefined,targetFormat:"{score}",targetKeep:!1,targetText:"",targetType:"hint",width:undefined}}(jQuery);